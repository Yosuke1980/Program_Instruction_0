<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ©ã‚¸ã‚ªç•ªçµ„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .tab-nav {
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            padding: 0;
        }

        .tab-nav ul {
            list-style: none;
            display: flex;
            margin: 0;
            padding: 0;
        }

        .tab-nav li {
            flex: 1;
        }

        .tab-nav button {
            width: 100%;
            padding: 15px 20px;
            border: none;
            background: transparent;
            color: #4a5568;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-nav button:hover {
            background: #edf2f7;
            color: #2d3748;
        }

        .tab-nav button.active {
            color: #667eea;
            background: white;
            border-bottom-color: #667eea;
        }

        /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .tab-content {
            display: none;
            padding: 40px;
        }

        .tab-content.active {
            display: block;
        }

        /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè»½é‡åŒ–ï¼‰ */
        .program-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .program-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .program-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .program-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .program-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .program-description {
            color: #718096;
            font-size: 0.95rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .btn {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn.loading {
            color: transparent;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .bulk-actions {
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
        }

        .bulk-actions h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .btn-secondary {
            background: #4a5568;
            color: white;
            margin: 0 10px;
            width: auto;
            padding: 10px 20px;
        }

        .btn-secondary:hover {
            background: #2d3748;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(74, 85, 104, 0.3);
        }

        /* çµæœè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .results-section {
            margin-top: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
        }

        .clear-btn {
            background: #e53e3e;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: #c53030;
        }

        .results-container {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
        }

        .result-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #48bb78;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .result-item.error {
            border-left-color: #e53e3e;
        }

        .result-timestamp {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 8px;
        }

        .result-content {
            color: #2d3748;
            line-height: 1.5;
        }

        .result-content.error {
            color: #e53e3e;
        }

        .empty-results {
            text-align: center;
            color: #a0aec0;
            font-style: italic;
            padding: 40px 20px;
        }

        .program-status {
            font-size: 0.85rem;
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
        }

        .status-ready {
            background-color: #f0fff4;
            color: #276749;
            border: 1px solid #9ae6b4;
        }

        .status-processing {
            background-color: #fffaf0;
            color: #c05621;
            border: 1px solid #f6ad55;
        }

        .status-completed {
            background-color: #f0fff4;
            color: #276749;
            border: 1px solid #9ae6b4;
        }

        .status-failed {
            background-color: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background-color: #48bb78;
        }

        .status-error {
            background-color: #e53e3e;
        }

        .status-loading {
            background-color: #ed8936;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .data-controls {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.9rem;
        }

        .form-select {
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            min-width: 180px;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .data-display {
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            min-height: 300px;
            padding: 20px;
            overflow-x: auto;
        }

        .empty-data {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 260px;
            color: #a0aec0;
            font-style: italic;
            text-align: center;
        }

        .loading-data {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 260px;
            color: #667eea;
        }

        .loading-data::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
            white-space: nowrap;
        }

        .data-table td {
            color: #4a5568;
            vertical-align: top;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        /* ç•ªçµ„ä¸€è¦§è¡¨å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .program-table th {
            cursor: pointer;
            user-select: none;
        }

        .program-table th:hover {
            background: #edf2f7;
        }

        .episode-details {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 10px 0;
        }

        .episode-table {
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .episode-table th,
        .episode-table td {
            padding: 8px 12px;
        }

        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .table-filters {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 0.8rem;
            border-radius: 4px;
        }

        .error-data {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #e53e3e;
            background: #fed7d7;
            border-radius: 8px;
            text-align: center;
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .data-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2d3748;
        }

        .data-info {
            font-size: 0.9rem;
            color: #718096;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 25px 20px;
            }

            .header h1 {
                font-size: 1.6rem;
            }

            .tab-content {
                padding: 25px 20px;
            }

            .program-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .bulk-actions {
                padding: 20px;
            }

            .btn-secondary {
                margin: 5px;
                width: calc(50% - 10px);
            }

            .data-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                width: 100%;
            }

            .form-select {
                min-width: auto;
            }

            .data-table {
                min-width: 600px;
            }
        }

        /* ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .debug-controls {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .debug-display {
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            min-height: 400px;
            overflow: hidden;
        }

        .debug-header {
            background: #f7fafc;
            padding: 15px 20px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-title {
            font-weight: 600;
            color: #2d3748;
            font-size: 1rem;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .json-container {
            margin: 0;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            background: white;
            color: #2d3748;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* JSON ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆé¢¨ */
        .json-container .json-key {
            color: #d73a49;
            font-weight: 600;
        }

        .json-container .json-string {
            color: #032f62;
        }

        .json-container .json-number {
            color: #005cc5;
        }

        .json-container .json-boolean {
            color: #e36209;
        }

        .json-container .json-null {
            color: #6f42c1;
        }

        .json-container .json-bracket {
            color: #24292e;
            font-weight: bold;
        }

        .loading-json {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #667eea;
        }

        .loading-json::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .debug-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .json-container {
                font-size: 0.75rem;
                max-height: 400px;
            }

            .debug-header {
                padding: 12px 15px;
            }
        }
        
        /* ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç·¨é›†ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .metadata-controls {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .metadata-editor {
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            padding: 30px;
            margin-bottom: 25px;
        }
        
        .metadata-display {
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            min-height: 300px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .empty-metadata {
            color: #a0aec0;
            font-style: italic;
            text-align: center;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .form-section:last-of-type {
            border-bottom: none;
        }
        
        .form-section h4 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .form-section h5 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2d3748;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .frame-type {
            margin-bottom: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .frame-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        .frame-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .frame-input {
            flex: 1;
            min-width: 120px;
            padding: 8px 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .frame-select {
            flex: 1;
            min-width: 120px;
            padding: 8px 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .btn-add {
            padding: 8px 16px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-add:hover {
            background: #38a169;
            transform: translateY(-1px);
        }
        
        .btn-remove {
            padding: 6px 10px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .btn-remove:hover {
            background: #c53030;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            margin-top: 20px;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c53030;
        }
        
        @media (max-width: 768px) {
            .metadata-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .form-group {
                min-width: auto;
            }
            
            .frame-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .frame-input,
            .frame-select {
                min-width: auto;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“» ãƒ©ã‚¸ã‚ªç•ªçµ„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆ</h1>
            <p>ç•ªçµ„åˆ¥ã«Wordãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã—ã¾ã™</p>
        </div>

        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="tab-nav">
            <ul>
                <li><button class="tab-button active" onclick="switchTab('generate')">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ</button></li>
                <li><button class="tab-button" onclick="switchTab('table')">ç•ªçµ„åˆ¥è©³ç´°è¡¨</button></li>
                <li><button class="tab-button" onclick="switchTab('dataflow')">ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼åˆ†æ</button></li>
            </ul>
        </div>

        <!-- ã‚¿ãƒ–1: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ -->
        <div id="tab-generate" class="tab-content active">
            <!-- ç•ªçµ„åˆ¥å®Ÿè¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="program-grid">
                <div class="program-card">
                    <div class="program-title">ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª</div>
                    <div class="program-description">ç¿Œé€±åˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆæœˆï½æœ¨æ”¾é€ï¼‰</div>
                    <button class="btn btn-primary" onclick="executeProgram('choudo')">
                        ç”Ÿæˆå®Ÿè¡Œ
                    </button>
                    <div class="program-status status-ready" id="status-choudo">
                        <span class="status-indicator status-success"></span>
                        å®Ÿè¡Œå¾…æ©Ÿä¸­
                    </div>
                </div>

                <div class="program-card">
                    <div class="program-title">PRIME TIME</div>
                    <div class="program-description">ç¿Œé€±åˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆæœˆï½æœ¨æ”¾é€ï¼‰</div>
                    <button class="btn btn-primary" onclick="executeProgram('primetime')">
                        ç”Ÿæˆå®Ÿè¡Œ
                    </button>
                    <div class="program-status status-ready" id="status-primetime">
                        <span class="status-indicator status-success"></span>
                        å®Ÿè¡Œå¾…æ©Ÿä¸­
                    </div>
                </div>

                <div class="program-card">
                    <div class="program-title">FLAG</div>
                    <div class="program-description">ä»Šé€±ã‹ã‚‰ã®4é€±é–“åˆ†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆé‡‘æ›œæ”¾é€ï¼‰</div>
                    <button class="btn btn-primary" onclick="executeProgram('flag')">
                        ç”Ÿæˆå®Ÿè¡Œ
                    </button>
                    <div class="program-status status-ready" id="status-flag">
                        <span class="status-indicator status-success"></span>
                        å®Ÿè¡Œå¾…æ©Ÿä¸­
                    </div>
                </div>

                <div class="program-card">
                    <div class="program-title">Route 847</div>
                    <div class="program-description">ä»Šé€±åˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆåœŸæ›œæ”¾é€ï¼‰</div>
                    <button class="btn btn-primary" onclick="executeProgram('route847')">
                        ç”Ÿæˆå®Ÿè¡Œ
                    </button>
                    <div class="program-status status-ready" id="status-route847">
                        <span class="status-indicator status-success"></span>
                        å®Ÿè¡Œå¾…æ©Ÿä¸­
                    </div>
                </div>

                <div class="program-card">
                    <div class="program-title">God Bless Saturday</div>
                    <div class="program-description">ä»Šé€±åˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆåœŸæ›œæ”¾é€ï¼‰</div>
                    <button class="btn btn-primary" onclick="executeProgram('godbless')">
                        ç”Ÿæˆå®Ÿè¡Œ
                    </button>
                    <div class="program-status status-ready" id="status-godbless">
                        <span class="status-indicator status-success"></span>
                        å®Ÿè¡Œå¾…æ©Ÿä¸­
                    </div>
                </div>
            </div>

            <div class="bulk-actions">
                <h3>ğŸš€ ä¸€æ‹¬å®Ÿè¡Œ</h3>
                <button class="btn btn-secondary" onclick="executeAllPrograms()">
                    å…¨ç•ªçµ„å®Ÿè¡Œ
                </button>
                <button class="btn btn-secondary" onclick="testAllPrograms()">
                    ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
                <button class="btn btn-secondary" onclick="checkConfiguration()">
                    è¨­å®šç¢ºèª
                </button>
            </div>
        </div>


        <!-- ã‚¿ãƒ–3: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼åˆ†æ -->
        <div id="tab-dataflow" class="tab-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <h3 style="color: #2d3748; margin-bottom: 10px;">ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼åˆ†æ</h3>
                <p style="color: #718096;">å„æ®µéšã§ã®JSONãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèªã§ãã¾ã™</p>
            </div>

            <div class="data-controls">
                <div class="control-group">
                    <label for="dataflow-program-select">ç•ªçµ„ã‚’é¸æŠ:</label>
                    <select id="dataflow-program-select" class="form-select">
                        <option value="">ç•ªçµ„ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª">ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª</option>
                        <option value="PRIME TIME">PRIME TIME</option>
                        <option value="FLAG">FLAG</option>
                        <option value="God Bless Saturday">God Bless Saturday</option>
                        <option value="Route 847">Route 847</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="dataflow-week-select">å¯¾è±¡é€±ã‚’é¸æŠ:</label>
                    <select id="dataflow-week-select" class="form-select">
                        <option value="thisWeek">ä»Šé€±</option>
                        <option value="nextWeek">æ¥é€±</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="dataflow-stage-select">åˆ†ææ®µéš:</label>
                    <select id="dataflow-stage-select" class="form-select">
                        <option value="all">å…¨æ®µéš</option>
                        <option value="1-INPUT-SHEET">1. ã‚·ãƒ¼ãƒˆå…¥åŠ›</option>
                        <option value="2-MARKERS-DETECTED">2. ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡º</option>
                        <option value="3-DATE-RANGES">3. æ—¥ä»˜ç¯„å›²è¨ˆç®—</option>
                        <option value="4-STRUCTURED-PROGRAMS">4. ç•ªçµ„æ§‹é€ åŒ–</option>
                        <option value="5-FINAL-WEEK-DATA">5. é€±ãƒ‡ãƒ¼ã‚¿æœ€çµ‚å½¢</option>
                        <option value="6-WEBAPP-INPUT">6. WebAppå…¥åŠ›</option>
                        <option value="7-RAW-WEEK-DATA">7. ç”Ÿé€±ãƒ‡ãƒ¼ã‚¿</option>
                        <option value="8-TRANSFORMED-WEEK-DATA">8. ãƒ‡ãƒ¼ã‚¿å¤‰æ›å¾Œ</option>
                        <option value="9-WEBAPP-FINAL-OUTPUT">9. WebAppæœ€çµ‚å‡ºåŠ›</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 30px;">
                <button onclick="loadDataFlowAnalysis()" class="btn btn-primary">
                    ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œãƒ»åˆ†æ
                </button>
                <button onclick="clearDataFlowData()" class="btn btn-secondary">
                    ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
                </button>
                <button onclick="exportDebugData()" class="btn btn-secondary">
                    JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
            </div>

            <div id="dataflow-display" class="data-display">
                <div class="empty-data">
                    ä¸Šè¨˜ã§ç•ªçµ„ãƒ»é€±ãƒ»æ®µéšã‚’é¸æŠã—ã¦ã€Œãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œãƒ»åˆ†æã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
                </div>
            </div>
            
            <div id="dataflow-stage-summary" style="margin-top: 20px; display: none;">
                <div style="background: #f8f9fa; border-radius: 8px; padding: 20px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">ğŸ“Š æ®µéšåˆ¥ãƒ‡ãƒ¼ã‚¿ã‚µãƒãƒªãƒ¼</h4>
                    <div id="stage-summary-content"></div>
                </div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–4: ç•ªçµ„ä¸€è¦§è¡¨ -->
        <div id="tab-table" class="tab-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <h3 style="color: #2d3748; margin-bottom: 10px;">ğŸ“Š ç•ªçµ„åˆ¥è©³ç´°è¡¨</h3>
                <p style="color: #718096;">é¸æŠã—ãŸç•ªçµ„ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨å½¢å¼ã§ç¢ºèªã§ãã¾ã™</p>
            </div>

            <div class="table-controls">
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div class="control-group">
                        <label for="program-select-table" style="font-weight: 600; color: #2d3748; margin-bottom: 8px; display: block;">ç•ªçµ„ã‚’é¸æŠ:</label>
                        <select id="program-select-table" class="form-select" style="width: 300px;">
                            <option value="">ç•ªçµ„ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª">ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª</option>
                            <option value="PRIME TIME">PRIME TIME</option>
                            <option value="FLAG">FLAG</option>
                            <option value="God Bless Saturday">God Bless Saturday</option>
                            <option value="Route 847">Route 847</option>
                            <option value="CHOICES">CHOICES</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="week-select-table" style="font-weight: 600; color: #2d3748; margin-bottom: 8px; display: block;">å¯¾è±¡é€±ã‚’é¸æŠ:</label>
                        <select id="week-select-table" class="form-select" style="width: 200px;">
                            <option value="thisWeek">ä»Šé€±</option>
                            <option value="nextWeek">æ¥é€±</option>
                            <option value="nextWeek2">2é€±å…ˆ</option>
                            <option value="nextWeek3">3é€±å…ˆ</option>
                        </select>
                    </div>
                </div>
                <button onclick="loadSingleProgramTable()" class="btn btn-primary">
                    ç•ªçµ„è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                </button>
            </div>

            <div id="table-display" class="data-display">
                <div class="empty-data">
                    ä¸Šè¨˜ã§ç•ªçµ„ã‚’é¸æŠã—ã¦ã€Œç•ªçµ„è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
                </div>
            </div>
            
            <!-- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="debug-log-section" style="margin-top: 20px; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0; color: #e53e3e;">ğŸ› ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h4>
                    <button id="hide-debug-btn" onclick="hideDebugLog()" class="btn" style="background: #f56565; color: white; font-size: 0.8rem; padding: 5px 10px;">
                        ãƒ­ã‚°ã‚’éš ã™
                    </button>
                </div>
                <div id="debug-log-content" style="background: #1a202c; color: #e2e8f0; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 0.85rem; max-height: 400px; overflow-y: auto; white-space: pre-wrap;">
                </div>
            </div>
            
            <!-- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
            <div id="debug-controls" style="margin-top: 15px; text-align: center; display: none;">
                <button id="show-debug-btn" onclick="showDebugLog()" class="btn" style="background: #4299e1; color: white; font-size: 0.9rem;">
                    ğŸ› ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¡¨ç¤º
                </button>
            </div>
        </div>


        <!-- å®Ÿè¡Œçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="results-section">
            <div class="results-header">
                <div class="results-title">ğŸ“‹ å®Ÿè¡Œçµæœ</div>
                <button class="clear-btn" onclick="clearResults()">
                    ã‚¯ãƒªã‚¢
                </button>
            </div>
            <div class="results-container" id="results">
                <div class="empty-results">
                    ã¾ã å®Ÿè¡ŒçµæœãŒã‚ã‚Šã¾ã›ã‚“
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œé–¢æ•°ãƒãƒƒãƒ”ãƒ³ã‚°
        var programFunctions = {
            'choudo': 'webAppAutoGenerateChoudo',
            'primetime': 'webAppAutoGeneratePrimeTime', 
            'flag': 'webAppAutoGenerateFlag',
            'route847': 'webAppAutoGenerateRoute847',
            'godbless': 'webAppAutoGenerateGodBless'
        };

        var programNames = {
            'choudo': 'ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª',
            'primetime': 'PRIME TIME',
            'flag': 'FLAG', 
            'route847': 'Route 847',
            'godbless': 'God Bless Saturday'
        };

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            // å…¨ã‚¿ãƒ–ã‚’éè¡¨ç¤º
            var tabs = document.querySelectorAll('.tab-content');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // å…¨ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            var buttons = document.querySelectorAll('.tab-button');
            for (var j = 0; j < buttons.length; j++) {
                buttons[j].classList.remove('active');
            }
            
            // æŒ‡å®šã‚¿ãƒ–ã‚’è¡¨ç¤º
            document.getElementById('tab-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // å˜ä¸€ç•ªçµ„å®Ÿè¡Œ
        function executeProgram(programKey) {
            var button = event.target;
            var statusEl = document.getElementById('status-' + programKey);
            var functionName = programFunctions[programKey];
            var programName = programNames[programKey];

            button.disabled = true;
            button.classList.add('loading');
            updateStatus(programKey, 'processing', 'å®Ÿè¡Œä¸­...');
            addResult(programName + 'ã®å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info');

            google.script.run
                .withSuccessHandler((result) => {
                    button.disabled = false;
                    button.classList.remove('loading');
                    updateStatus(programKey, 'completed', 'å®Ÿè¡Œå®Œäº†');

                    if (result && result.success) {
                        addResult('âœ… ' + programName + ': ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆå®Œäº†\nDocxé€ä¿¡: ' + (result.docxSent ? 'æˆåŠŸ' : 'å¤±æ•—'), 'success');
                        if (result.url) {
                            addResult('ğŸ“„ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆURL: ' + result.url, 'info');
                        }
                    } else {
                        addResult('âš ï¸ ' + programName + ': å®Ÿè¡Œã¯å®Œäº†ã—ã¾ã—ãŸãŒã€è©³ç´°ã¯è¦ç¢ºèª', 'warning');
                        updateStatus(programKey, 'failed', 'è¦ç¢ºèª');
                    }
                })
                .withFailureHandler((error) => {
                    button.disabled = false;
                    button.classList.remove('loading');
                    updateStatus(programKey, 'failed', 'å®Ÿè¡Œå¤±æ•—');
                    addResult('âŒ ' + programName + ': å®Ÿè¡Œã‚¨ãƒ©ãƒ¼\n' + (error.message || error.toString()), 'error');
                })
                [functionName]();
        }

        // å…¨ç•ªçµ„å®Ÿè¡Œ
        function executeAllPrograms() {
            addResult('ğŸš€ å…¨ç•ªçµ„ã®ä¸€æ‹¬å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã™', 'info');
            
            var programKeys = Object.keys(programFunctions);
            for (var k = 0; k < programKeys.length; k++) {
                (function(programKey, index) {
                    setTimeout(function() {
                        var button = document.querySelector('[onclick="executeProgram(\'' + programKey + '\')"]');
                        if (button && !button.disabled) {
                            button.click();
                        }
                    }, index * 2000);
                })(programKeys[k], k);
            }
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function testAllPrograms() {
            addResult('ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã™', 'info');
            
            google.script.run
                .withSuccessHandler(function(results) {
                    addResult('ğŸ“Š ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ:', 'info');
                    for (var r = 0; r < results.length; r++) {
                        var result = results[r];
                        var status = result.success ? 'âœ…' : 'âŒ';
                        var docxStatus = result.docxSent ? ' (Docxé€ä¿¡æˆåŠŸ)' : ' (Docxé€ä¿¡å¤±æ•—)';
                        addResult(status + ' ' + result.program + ': ' + (result.success ? 'æˆåŠŸ' : result.error) + (result.success ? docxStatus : ''), result.success ? 'success' : 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    addResult('âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppTestAllGeneration();
        }

        // è¨­å®šç¢ºèª
        function checkConfiguration() {
            addResult('ğŸ”§ è¨­å®šç¢ºèªã‚’é–‹å§‹ã—ã¾ã™', 'info');
            
            google.script.run
                .withSuccessHandler(function(config) {
                    addResult('ğŸ“‹ è¨­å®šç¢ºèªçµæœ:', 'info');
                    addResult('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID: ' + (config.hasSpreadsheetId ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'), config.hasSpreadsheetId ? 'success' : 'error');
                    addResult('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ID: ' + (config.hasCalendarId ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'), config.hasCalendarId ? 'success' : 'error');
                    addResult('æ¥½æ›²ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID: ' + (config.hasMusicSpreadsheetId ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'), config.hasMusicSpreadsheetId ? 'success' : 'error');
                    addResult('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ' + (config.hasEmailAddress ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'), config.hasEmailAddress ? 'success' : 'error');
                    addResult('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: ' + (config.hasDocumentTemplates ? 'âœ… ' + config.templateCount + 'ä»¶è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'), config.hasDocumentTemplates ? 'success' : 'error');
                    addResult('å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€: ' + (config.hasOutputFolder ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'), config.hasOutputFolder ? 'success' : 'error');
                })
                .withFailureHandler(function(error) {
                    addResult('âŒ è¨­å®šç¢ºèªã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppGetConfigInfo();
        }

        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç·¨é›†é–¢é€£é–¢æ•°
        let currentProgramMetadata = null;
        let isEditMode = false;
        
        function loadProgramMetadata() {
            const programSelect = document.getElementById('metadata-program-select');
            const programName = programSelect.value;
            
            if (!programName) {
                document.getElementById('metadata-editor').style.display = 'none';
                document.getElementById('metadata-display').innerHTML = '<div class="empty-metadata">ç•ªçµ„ã‚’é¸æŠã—ã¦ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            addResult('ğŸ“ ' + programName + ' ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
            
            google.script.run
                .withSuccessHandler((result) => {
                    if (result && result.success) {
                        const programData = result.data.programs.find(p => p.name === programName);
                        if (programData) {
                            currentProgramMetadata = programData;
                            populateMetadataForm(programData);
                            document.getElementById('metadata-editor').style.display = 'block';
                            document.getElementById('metadata-display').innerHTML = '';
                            addResult('âœ… ' + programName + ' ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†', 'success');
                        } else {
                            addResult('âš ï¸ ' + programName + ' ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                        }
                    } else {
                        addResult('âŒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                })
                .withFailureHandler((error) => {
                    addResult('âŒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppGetProgramMetadataAsJSONUnified();
        }

        function populateMetadataForm(programData) {
            document.getElementById('program-name').value = programData.name || '';
            document.getElementById('program-id').value = programData.programId || '';
            document.getElementById('production-company').value = programData.meta.productionCompany || '';
            document.getElementById('genre').value = programData.meta.genre || '';
            document.getElementById('start-date').value = programData.meta.startDate || '';
            document.getElementById('regular-slots').value = programData.meta.regularSlots ? programData.meta.regularSlots.join(', ') : '';
            document.getElementById('hosts').value = programData.meta.hosts ? programData.meta.hosts.join(', ') : '';
            document.getElementById('notes').value = programData.meta.notes ? programData.meta.notes.join(', ') : '';
            
            // ãƒ•ãƒ¬ãƒ¼ãƒ æƒ…å ±ã‚’ãƒ­ãƒ¼ãƒ‰
            loadFrames('publicity', programData.meta.publicityFrames || []);
            loadFrames('report', programData.meta.reportFrames || []);
            loadFrames('call', programData.meta.callFrames || []);
            loadFrames('special', programData.meta.specialFrames || []);
            
            isEditMode = true;
        }

        function loadFrames(frameType, frames) {
            const container = document.getElementById(frameType + '-frames');
            container.innerHTML = '';
            
            frames.forEach((frame, index) => {
                addFrameElement(frameType, frame, index);
            });
        }

        function addFrame(frameType) {
            const frameData = getDefaultFrameData(frameType);
            const container = document.getElementById(frameType + '-frames');
            const index = container.children.length;
            addFrameElement(frameType, frameData, index);
        }
        
        function getDefaultFrameData(frameType) {
            switch(frameType) {
                case 'publicity':
                    return { time: '', allowedModes: [], label: '' };
                case 'report':
                case 'call':
                    return '';
                case 'special':
                    return { label: '', day: '' };
                default:
                    return {};
            }
        }
        
        function addFrameElement(frameType, frameData, index) {
            const container = document.getElementById(frameType + '-frames');
            const frameDiv = document.createElement('div');
            frameDiv.className = 'frame-item';
            frameDiv.dataset.index = index;
            
            let html = '';
            
            if (frameType === 'publicity') {
                html = `
                    <div class="frame-controls">
                        <input type="text" placeholder="æ™‚åˆ» (07:28)" value="${frameData.time || ''}" class="frame-input" data-field="time">
                        <input type="text" placeholder="ãƒ©ãƒ™ãƒ«" value="${frameData.label || ''}" class="frame-input" data-field="label">
                        <select multiple class="frame-select" data-field="allowedModes">
                            <option value="script" ${frameData.allowedModes && frameData.allowedModes.includes('script') ? 'selected' : ''}>åŸç¨¿</option>
                            <option value="phone" ${frameData.allowedModes && frameData.allowedModes.includes('phone') ? 'selected' : ''}>é›»è©±</option>
                            <option value="report" ${frameData.allowedModes && frameData.allowedModes.includes('report') ? 'selected' : ''}>ãƒªãƒãƒ¼ãƒˆ</option>
                        </select>
                        <button type="button" class="btn-remove" onclick="removeFrame(this)">Ã—</button>
                    </div>
                `;
            } else if (frameType === 'special') {
                html = `
                    <div class="frame-controls">
                        <input type="text" placeholder="ãƒ©ãƒ™ãƒ«" value="${frameData.label || ''}" class="frame-input" data-field="label">
                        <input type="text" placeholder="æ›œæ—¥ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)" value="${frameData.day || ''}" class="frame-input" data-field="day">
                        <button type="button" class="btn-remove" onclick="removeFrame(this)">Ã—</button>
                    </div>
                `;
            } else {
                html = `
                    <div class="frame-controls">
                        <input type="text" placeholder="${frameType === 'report' ? 'ãƒªãƒãƒ¼ãƒˆ' : 'ã‚³ãƒ¼ãƒ«'}ãƒ•ãƒ¬ãƒ¼ãƒ æƒ…å ±" value="${frameData}" class="frame-input" data-field="value">
                        <button type="button" class="btn-remove" onclick="removeFrame(this)">Ã—</button>
                    </div>
                `;
            }
            
            frameDiv.innerHTML = html;
            container.appendChild(frameDiv);
        }
        
        function removeFrame(button) {
            button.closest('.frame-item').remove();
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus(programKey, status, text) {
            const statusEl = document.getElementById('status-' + programKey);
            const indicator = statusEl.querySelector('.status-indicator');
            
            statusEl.className = 'program-status';
            indicator.className = 'status-indicator';
            
            switch(status) {
                case 'processing':
                    statusEl.classList.add('status-processing');
                    indicator.classList.add('status-loading');
                    break;
                case 'completed':
                    statusEl.classList.add('status-completed');
                    indicator.classList.add('status-success');
                    break;
                case 'failed':
                    statusEl.classList.add('status-failed');
                    indicator.classList.add('status-error');
                    break;
                default:
                    statusEl.classList.add('status-ready');
                    indicator.classList.add('status-success');
            }
            
            statusEl.innerHTML = '<span class="' + indicator.className + '"></span>' + text;
        }

        // çµæœè¡¨ç¤º
        function addResult(message, type) {
            type = type || 'info';
            const resultsContainer = document.getElementById('results');
            
            const emptyMessage = resultsContainer.querySelector('.empty-results');
            if (emptyMessage) {
                emptyMessage.remove();
            }

            const resultItem = document.createElement('div');
            resultItem.className = 'result-item' + (type === 'error' || type === 'warning' ? ' error' : '');
            
            const timestamp = new Date().toLocaleString('ja-JP');
            resultItem.innerHTML = '<div class="result-timestamp">' + timestamp + '</div><div class="result-content' + (type === 'error' ? ' error' : '') + '">' + message.replace(/\n/g, '<br>') + '</div>';

            resultsContainer.insertBefore(resultItem, resultsContainer.firstChild);
            resultsContainer.scrollTop = 0;
        }

        // çµæœã‚¯ãƒªã‚¢
        function clearResults() {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '<div class="empty-results">ã¾ã å®Ÿè¡ŒçµæœãŒã‚ã‚Šã¾ã›ã‚“</div>';
        }
        
        function createNewProgram() {
            currentProgramMetadata = null;
            document.getElementById('metadata-program-select').value = '';
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('metadata-form').reset();
            
            // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            ['publicity', 'report', 'call', 'special'].forEach(frameType => {
                document.getElementById(frameType + '-frames').innerHTML = '';
            });
            
            document.getElementById('metadata-editor').style.display = 'block';
            document.getElementById('metadata-display').innerHTML = '';
            isEditMode = false;
            
            addResult('ğŸ“ æ–°è¦ç•ªçµ„ã®ä½œæˆãƒ¢ãƒ¼ãƒ‰ã§ã™', 'info');
        }
        
        function saveMetadata() {
            const formData = collectFormData();
            
            if (!formData.name || !formData.programId) {
                addResult('âš ï¸ ç•ªçµ„åã¨ç•ªçµ„IDã¯å¿…é ˆã§ã™', 'warning');
                return;
            }
            
            const action = isEditMode ? 'æ›´æ–°' : 'ä¿å­˜';
            addResult('ğŸ’¾ ' + formData.name + ' ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’' + action + 'ä¸­...', 'info');
            
            google.script.run
                .withSuccessHandler((result) => {
                    if (result && result.success) {
                        addResult('âœ… ' + formData.name + ' ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿' + action + 'ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                        currentProgramMetadata = formData;
                        isEditMode = true;
                    } else {
                        addResult('âŒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®' + action + 'ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                })
                .withFailureHandler((error) => {
                    addResult('âŒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿' + action + 'ã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppSaveProgramMetadata(formData);
        }
        
        function collectFormData() {
            const formData = {
                programId: document.getElementById('program-id').value,
                name: document.getElementById('program-name').value,
                meta: {
                    regularSlots: document.getElementById('regular-slots').value.split(',').map(s => s.trim()).filter(s => s),
                    hosts: document.getElementById('hosts').value.split(',').map(s => s.trim()).filter(s => s),
                    productionCompany: document.getElementById('production-company').value,
                    startDate: document.getElementById('start-date').value,
                    genre: document.getElementById('genre').value,
                    publicityFrames: collectFrameData('publicity'),
                    reportFrames: collectFrameData('report'),
                    callFrames: collectFrameData('call'),
                    specialFrames: collectFrameData('special'),
                    notes: document.getElementById('notes').value.split(',').map(s => s.trim()).filter(s => s)
                }
            };
            
            return formData;
        }
        
        function collectFrameData(frameType) {
            const container = document.getElementById(frameType + '-frames');
            const frames = [];
            
            Array.from(container.children).forEach(frameItem => {
                if (frameType === 'publicity') {
                    const time = frameItem.querySelector('[data-field="time"]').value;
                    const label = frameItem.querySelector('[data-field="label"]').value;
                    const allowedModesSelect = frameItem.querySelector('[data-field="allowedModes"]');
                    const allowedModes = Array.from(allowedModesSelect.selectedOptions).map(option => option.value);
                    
                    if (time || label || allowedModes.length > 0) {
                        frames.push({ time, label, allowedModes });
                    }
                } else if (frameType === 'special') {
                    const label = frameItem.querySelector('[data-field="label"]').value;
                    const day = frameItem.querySelector('[data-field="day"]').value;
                    
                    if (label) {
                        const frameData = { label };
                        if (day) frameData.day = day;
                        frames.push(frameData);
                    }
                } else {
                    const value = frameItem.querySelector('[data-field="value"]').value;
                    if (value) {
                        frames.push(value);
                    }
                }
            });
            
            return frames;
        }
        
        function cancelEdit() {
            document.getElementById('metadata-editor').style.display = 'none';
            document.getElementById('metadata-display').innerHTML = '<div class="empty-metadata">ç•ªçµ„ã‚’é¸æŠã—ã¦ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ã—ã¦ãã ã•ã„</div>';
            document.getElementById('metadata-program-select').value = '';
            currentProgramMetadata = null;
            isEditMode = false;
            addResult('âŒ ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ', 'info');
        }
        
        function deleteProgram() {
            if (!currentProgramMetadata) {
                addResult('âš ï¸ å‰Šé™¤ã™ã‚‹ç•ªçµ„ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                return;
            }
            
            if (!confirm(currentProgramMetadata.name + ' ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            addResult('ğŸ—‘ï¸ ' + currentProgramMetadata.name + ' ã‚’å‰Šé™¤ä¸­...', 'info');
            
            google.script.run
                .withSuccessHandler((result) => {
                    if (result && result.success) {
                        addResult('âœ… ' + currentProgramMetadata.name + ' ã®å‰Šé™¤ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                        cancelEdit();
                    } else {
                        addResult('âŒ ç•ªçµ„ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                })
                .withFailureHandler((error) => {
                    addResult('âŒ ç•ªçµ„å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppDeleteProgramMetadata(currentProgramMetadata.programId);
        }

        // ãƒ‡ãƒ¼ã‚¿æ§‹é€ å–å¾—ãƒ»è¡¨ç¤ºæ©Ÿèƒ½ï¼ˆãƒ¢ãƒ¼ãƒ‰åˆ¥ï¼‰
        function loadSelectedProgramData() {
            const programSelect = document.getElementById('debug-program-select');
            const weekSelect = document.getElementById('debug-week-select');
            const modeSelect = document.getElementById('data-mode-select');
            const jsonOutput = document.getElementById('json-output');
            const copyBtn = document.getElementById('copy-json-btn');
            const loadButton = event.target;

            const programName = programSelect.value;
            const weekType = weekSelect.value;
            const dataMode = modeSelect.value;

            // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ç•ªçµ„é¸æŠä¸è¦
            if (!programName && dataMode !== 'metadata') {
                addResult('âš ï¸ ç•ªçµ„ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã«ã™ã‚‹
            loadButton.disabled = true;
            loadButton.classList.add('loading');
            jsonOutput.innerHTML = '<div class="loading-json">ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å–å¾—ä¸­...</div>';
            copyBtn.style.display = 'none';

            const modeNames = {
                'raw': 'ç”Ÿãƒ‡ãƒ¼ã‚¿',
                'filtered': 'ç•ªçµ„ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿',
                'simplified': 'ç°¡ç´ åŒ–ãƒ‡ãƒ¼ã‚¿',
                'rawprogram': 'å®Œå…¨ç”Ÿãƒ‡ãƒ¼ã‚¿',
                'metadata': 'ç•ªçµ„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿'
            };

            // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ç•°ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            if (dataMode === 'metadata') {
                addResult('ğŸ” å…¨ç•ªçµ„ã®' + modeNames[dataMode] + 'ã‚’å–å¾—ä¸­...', 'info');
            } else {
                addResult('ğŸ” ' + programName + ' ã®' + (weekType === 'thisWeek' ? 'ä»Šé€±' : 'ç¿Œé€±') + 'åˆ†' + modeNames[dataMode] + 'ã‚’å–å¾—ä¸­...', 'info');
            }

            // ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦é©åˆ‡ãªGASé–¢æ•°ã‚’å‘¼ã³å‡ºã—
            let gasFunction;
            let gasParams = [programName, weekType];
            
            switch(dataMode) {
                case 'raw':
                    gasFunction = 'webAppGetProgramData';
                    break;
                case 'filtered':
                    gasFunction = 'webAppGetFilteredProgramData';
                    break;
                case 'simplified':
                    gasFunction = 'webAppGetSimplifiedProgramData';
                    break;
                case 'rawprogram':
                    gasFunction = 'webAppGetRawProgramDataUnfiltered';
                    break;
                case 'metadata':
                    gasFunction = 'webAppGetProgramMetadataAsJSONUnified';
                    gasParams = []; // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ç•ªçµ„ãƒ»é€±æŒ‡å®šä¸è¦
                    break;
                default:
                    gasFunction = 'webAppGetProgramData';
            }

            // Google Apps Scripté–¢æ•°ã‚’å®Ÿè¡Œ
            google.script.run
                .withSuccessHandler((result) => {
                    loadButton.disabled = false;
                    loadButton.classList.remove('loading');

                    if (result && result.success) {
                        displayJsonData(result, dataMode);
                        copyBtn.style.display = 'block';
                        
                        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ç•°ãªã‚‹æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                        if (dataMode === 'metadata') {
                            addResult('âœ… å…¨ç•ªçµ„ã®' + modeNames[dataMode] + 'å–å¾—å®Œäº† (' + (result.programCount || 0) + 'ç•ªçµ„)', 'success');
                        } else {
                            addResult('âœ… ' + programName + ' ã®' + modeNames[dataMode] + 'å–å¾—å®Œäº†', 'success');
                        }
                    } else {
                        jsonOutput.innerHTML = 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ\n\nã‚¨ãƒ©ãƒ¼: ' + (result ? result.error || 'ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒä¸æ˜ã§ã™' : 'çµæœãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                        
                        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ç•°ãªã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                        if (dataMode === 'metadata') {
                            addResult('âŒ å…¨ç•ªçµ„ã®' + modeNames[dataMode] + 'å–å¾—å¤±æ•—: ' + (result ? result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼' : 'çµæœãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ'), 'error');
                        } else {
                            addResult('âŒ ' + programName + ' ã®' + modeNames[dataMode] + 'å–å¾—å¤±æ•—: ' + (result ? result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼' : 'çµæœãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ'), 'error');
                        }
                    }
                })
                .withFailureHandler((error) => {
                    loadButton.disabled = false;
                    loadButton.classList.remove('loading');
                    jsonOutput.innerHTML = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ\n\n' + (error.message || error.toString());
                    addResult('âŒ ãƒ‡ãƒ¼ã‚¿æ§‹é€ å–å¾—ã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                [gasFunction](...gasParams);
        }
        
        // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã®é–¢æ•°
        function loadFullProgramData() {
            loadSelectedProgramData();
        }

        // JSON ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
        function displayJsonData(result, dataMode = 'raw') {
            const jsonOutput = document.getElementById('json-output');
            
            let displayData;
            
            if (dataMode === 'simplified') {
                // ç°¡ç´ åŒ–ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯æ§‹é€ ã‚’æ•´ç†ã—ã¦è¡¨ç¤º
                displayData = {
                    programName: result.programName,
                    weekType: result.weekType,
                    simplified: result.simplified,
                    timestamp: result.timestamp,
                    data: result.data
                };
            } else if (dataMode === 'filtered') {
                // ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®å ´åˆ
                displayData = {
                    programName: result.programName,
                    weekType: result.weekType,
                    filtered: result.filtered,
                    sheetName: result.sheetName,
                    timestamp: result.timestamp,
                    weekResults: result.weekResults
                };
            } else if (dataMode === 'metadata') {
                // ç•ªçµ„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å ´åˆ
                displayData = {
                    success: result.success,
                    timestamp: result.timestamp,
                    programCount: result.programCount,
                    data: result.data
                };
            } else if (dataMode === 'rawprogram') {
                // å®Œå…¨ç”Ÿãƒ‡ãƒ¼ã‚¿ã®å ´åˆ
                displayData = {
                    success: result.success,
                    programName: result.programName,
                    weekType: result.weekType,
                    sheetName: result.sheetName,
                    timestamp: result.timestamp,
                    rawProgramData: result.data
                };
            } else {
                // ç”Ÿãƒ‡ãƒ¼ã‚¿ã®å ´åˆï¼ˆå¾“æ¥é€šã‚Šï¼‰
                displayData = {
                    success: result.success,
                    programName: result.programName,
                    weekType: result.weekType,
                    sheetName: result.sheetName,
                    timestamp: result.timestamp,
                    data: result.data,
                    weekResults: result.weekResults,
                    rawResult: result
                };
            }
            
            // JSONæ–‡å­—åˆ—ã«å¤‰æ›ï¼ˆç¾ã—ãæ•´å½¢ï¼‰
            const jsonString = JSON.stringify(displayData, null, 2);
            
            // ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆé¢¨ã®è¡¨ç¤º
            const highlightedJson = syntaxHighlight(jsonString);
            jsonOutput.innerHTML = highlightedJson;
        }

        // JSON ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                var cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        // JSONã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        function copyJsonToClipboard() {
            const jsonOutput = document.getElementById('json-output');
            const textToCopy = jsonOutput.textContent || jsonOutput.innerText;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    addResult('ğŸ“‹ JSONãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success');
                }).catch(() => {
                    addResult('âŒ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                });
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    addResult('ğŸ“‹ JSONãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success');
                } catch (err) {
                    addResult('âŒ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addResult('ğŸ“» ãƒ©ã‚¸ã‚ªç•ªçµ„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆã‚¢ãƒ—ãƒªãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸ', 'info');
            
            setTimeout(function() {
                google.script.run
                    .withSuccessHandler(function(config) {
                        var allConfigured = config.hasSpreadsheetId && config.hasCalendarId && 
                                            config.hasEmailAddress && config.hasDocumentTemplates && 
                                            config.hasOutputFolder;
                        
                        if (allConfigured) {
                            addResult('âœ… åŸºæœ¬è¨­å®šã¯æ­£å¸¸ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™', 'success');
                        } else {
                            addResult('âš ï¸ ä¸€éƒ¨ã®è¨­å®šãŒä¸å®Œå…¨ã§ã™ã€‚ã€Œè¨­å®šç¢ºèªã€ãƒœã‚¿ãƒ³ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'warning');
                        }
                    })
                    .withFailureHandler(function(error) {
                        addResult('âš ï¸ åˆæœŸè¨­å®šç¢ºèªã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'warning');
                    })
                    .webAppGetConfigInfo();
            }, 1000);
        });

        // ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼åˆ†æé–¢æ•°ç¾¤
        function loadDataFlowAnalysis() {
            const programSelect = document.getElementById('dataflow-program-select');
            const weekSelect = document.getElementById('dataflow-week-select');
            const stageSelect = document.getElementById('dataflow-stage-select');
            
            const programName = programSelect.value;
            const weekType = weekSelect.value;
            const targetStage = stageSelect.value;
            
            if (!programName) {
                addResult('âš ï¸ ç•ªçµ„ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }
            
            const dataflowDisplay = document.getElementById('dataflow-display');
            dataflowDisplay.innerHTML = '<div class="loading-data">ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œä¸­...</div>';
            
            // ã¾ãšç•ªçµ„ãƒ‡ãƒ¼ã‚¿ã‚’å®Ÿè¡Œã—ã¦ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            addResult('ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼åˆ†æé–‹å§‹: ' + programName + ' (' + (weekType === 'thisWeek' ? 'ä»Šé€±' : 'æ¥é€±') + ')', 'info');
            
            google.script.run
                .withSuccessHandler((result) => {
                    if (result && result.success) {
                        // ç•ªçµ„ãƒ‡ãƒ¼ã‚¿ã®å®Ÿè¡ŒãŒå®Œäº†ã—ãŸã‚‰ã€ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                        fetchDebugData(targetStage, programName, weekType);
                    } else {
                        dataflowDisplay.innerHTML = `<div class="error-data">ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}</div>`;
                        addResult('âŒ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                })
                .withFailureHandler((error) => {
                    dataflowDisplay.innerHTML = `<div class="error-data">å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                    addResult('âŒ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppGetProgramData(programName, weekType);
        }
        
        function fetchDebugData(targetStage, programName, weekType) {
            google.script.run
                .withSuccessHandler((debugResult) => {
                    if (debugResult && debugResult.success) {
                        displayDataFlowAnalysis(debugResult.data, targetStage, programName, weekType);
                        addResult('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼åˆ†æå®Œäº†: ' + debugResult.dataCount + 'ä»¶ã®ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿', 'success');
                    } else {
                        const dataflowDisplay = document.getElementById('dataflow-display');
                        dataflowDisplay.innerHTML = `<div class="error-data">ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${debugResult.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}</div>`;
                        addResult('âŒ ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                })
                .withFailureHandler((error) => {
                    const dataflowDisplay = document.getElementById('dataflow-display');
                    dataflowDisplay.innerHTML = `<div class="error-data">ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                    addResult('âŒ ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppGetDebugData(targetStage === 'all' ? undefined : targetStage);
        }
        
        function displayDataFlowAnalysis(debugData, targetStage, programName, weekType) {
            const dataflowDisplay = document.getElementById('dataflow-display');
            const stageSummary = document.getElementById('dataflow-stage-summary');
            const summaryContent = document.getElementById('stage-summary-content');
            
            if (!debugData || Object.keys(debugData).length === 0) {
                dataflowDisplay.innerHTML = '<div class="empty-data">ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            // æ®µéšåˆ¥ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†
            const stageGroups = {};
            Object.entries(debugData).forEach(([key, data]) => {
                const stage = data.stage;
                if (!stageGroups[stage]) {
                    stageGroups[stage] = [];
                }
                stageGroups[stage].push({ key, data });
            });
            
            // æ®µéšé †ã«ã‚½ãƒ¼ãƒˆ
            const stageOrder = [
                '1-INPUT-SHEET', '2-MARKERS-DETECTED', '3-DATE-RANGES', 
                '4-STRUCTURED-PROGRAMS', '5-FINAL-WEEK-DATA', '6-WEBAPP-INPUT',
                '7-RAW-WEEK-DATA', '8-TRANSFORMED-WEEK-DATA', '9-WEBAPP-FINAL-OUTPUT'
            ];
            
            var html = '<div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">' +
                '<h4 style="color: #2d3748; margin: 0 0 5px 0;">' + programName + ' ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼åˆ†æ</h4>' +
                '<p style="color: #718096; margin: 0; font-size: 0.9rem;">å¯¾è±¡: ' + (weekType === 'thisWeek' ? 'ä»Šé€±' : 'æ¥é€±') + ' | æ®µéš: ' + (targetStage === 'all' ? 'å…¨æ®µéš' : targetStage) + ' | ãƒ‡ãƒ¼ã‚¿æ•°: ' + Object.keys(debugData).length + 'ä»¶</p>' +
                '</div>';
            
            // æ®µéšåˆ¥ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆ
            var summaryHtml = '';
            var displayedStages = 0;
            
            stageOrder.forEach(function(stage) {
                if (stageGroups[stage] && (targetStage === 'all' || targetStage === stage)) {
                    displayedStages++;
                    var stageData = stageGroups[stage][0]; // æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                    var data = stageData.data;
                    
                    summaryHtml += '<div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px; border-left: 4px solid #667eea;">' +
                        '<div style="display: flex; justify-content: space-between; align-items: center;">' +
                        '<strong>' + getStageDisplayName(stage) + '</strong>' +
                        '<span style="color: #718096; font-size: 0.85rem;">' + data.timestamp + '</span>' +
                        '</div>' +
                        '<div style="margin-top: 5px; font-size: 0.9rem; color: #4a5568;">' +
                        'ãƒ‡ãƒ¼ã‚¿å‹: ' + data.dataType + ' ' + (data.isArray ? '(é…åˆ—)' : '') + ' | ' +
                        (data.dataType === 'object' ? 'ã‚­ãƒ¼æ•°: ' + data.keyCount : 'å€¤: ' + (typeof data.data === 'string' ? data.data.substring(0, 50) + '...' : JSON.stringify(data.data).substring(0, 50) + '...')) +
                        '</div>' +
                        '</div>';
                    
                    html += '<div style="margin-bottom: 30px;">' +
                        '<h5 style="color: #2d3748; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 2px solid #e2e8f0;">' +
                        getStageDisplayName(stage) +
                        '</h5>' +
                        '<div style="background: #f7fafc; padding: 10px; border-radius: 6px; margin-bottom: 10px; font-size: 0.9rem;">' +
                        '<strong>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ:</strong> ' + data.context + '<br>' +
                        '<strong>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—:</strong> ' + data.timestamp + '<br>' +
                        '<strong>ãƒ‡ãƒ¼ã‚¿å‹:</strong> ' + data.dataType + ' ' + (data.isArray ? '(é…åˆ—)' : '') + ' | ' +
                        (data.dataType === 'object' ? 'ã‚­ãƒ¼æ•°: ' + data.keyCount : '') +
                        '</div>' +
                        '<div style="max-height: 400px; overflow-y: auto;">' +
                        '<pre style="background: #1a202c; color: #e2e8f0; padding: 15px; border-radius: 6px; font-size: 0.8rem; line-height: 1.4; margin: 0;">' + syntaxHighlightJSON(JSON.stringify(data.data, null, 2)) + '</pre>' +
                        '</div>' +
                        '</div>';
                }
            });
            
            if (displayedStages > 0) {
                dataflowDisplay.innerHTML = html;
                summaryContent.innerHTML = summaryHtml;
                stageSummary.style.display = 'block';
            } else {
                dataflowDisplay.innerHTML = '<div class="empty-data">æŒ‡å®šã•ã‚ŒãŸæ®µéšã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                stageSummary.style.display = 'none';
            }
        }
        
        function getStageDisplayName(stage) {
            const stageNames = {
                '1-INPUT-SHEET': '1. ã‚·ãƒ¼ãƒˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿',
                '2-MARKERS-DETECTED': '2. ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºçµæœ',
                '3-DATE-RANGES': '3. æ—¥ä»˜ç¯„å›²è¨ˆç®—çµæœ',
                '4-STRUCTURED-PROGRAMS': '4. ç•ªçµ„æ§‹é€ åŒ–çµæœ',
                '5-FINAL-WEEK-DATA': '5. é€±ãƒ‡ãƒ¼ã‚¿æœ€çµ‚å½¢',
                '6-WEBAPP-INPUT': '6. WebAppå…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿',
                '7-RAW-WEEK-DATA': '7. ç”Ÿé€±ãƒ‡ãƒ¼ã‚¿',
                '8-TRANSFORMED-WEEK-DATA': '8. ãƒ‡ãƒ¼ã‚¿å¤‰æ›å¾Œ',
                '9-WEBAPP-FINAL-OUTPUT': '9. WebAppæœ€çµ‚å‡ºåŠ›'
            };
            return stageNames[stage] || stage;
        }
        
        function syntaxHighlightJSON(json) {
            return json
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                    let cls = 'json-number';
                    if (/^"/.test(match)) {
                        if (/:$/.test(match)) {
                            cls = 'json-key';
                        } else {
                            cls = 'json-string';
                        }
                    } else if (/true|false/.test(match)) {
                        cls = 'json-boolean';
                    } else if (/null/.test(match)) {
                        cls = 'json-null';
                    }
                    return '<span style="color: ' + getJSONColor(cls) + '">' + match + '</span>';
                });
        }
        
        function getJSONColor(cls) {
            const colors = {
                'json-key': '#d73a49',
                'json-string': '#032f62', 
                'json-number': '#005cc5',
                'json-boolean': '#e36209',
                'json-null': '#6f42c1'
            };
            return colors[cls] || '#e2e8f0';
        }
        
        function clearDataFlowData() {
            google.script.run
                .withSuccessHandler(() => {
                    document.getElementById('dataflow-display').innerHTML = '<div class="empty-data">ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
                    document.getElementById('dataflow-stage-summary').style.display = 'none';
                    addResult('ğŸ—‘ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
                })
                .withFailureHandler((error) => {
                    addResult('âŒ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .clearDebugData();
        }
        
        function exportDebugData() {
            const programSelect = document.getElementById('dataflow-program-select');
            const weekSelect = document.getElementById('dataflow-week-select');
            const programName = programSelect.value || 'all';
            const weekType = weekSelect.value || 'all';
            
            google.script.run
                .withSuccessHandler((result) => {
                    if (result && result.success) {
                        // Google Driveã«ä¿å­˜ã•ã‚ŒãŸURLã‚’è¡¨ç¤º
                        const fileName = `debug_${programName}_${weekType}_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;
                        addResult('ğŸ’¾ ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ: ' + fileName, 'success');
                    } else {
                        addResult('âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                    }
                })
                .withFailureHandler((error) => {
                    addResult('âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ' + (error.message || error.toString()), 'error');
                })
                .webAppGetDebugData();
        }

        // Google Apps Scriptç”¨ã®stubï¼ˆå®Ÿéš›ã®ç’°å¢ƒã§ã¯ä¸è¦ï¼‰
        if (typeof google === 'undefined') {
            window.google = {
                script: {
                    run: {
                        withSuccessHandler: function(callback) {
                            return {
                                withFailureHandler: function(errorCallback) {
                                    return {
                                        webAppAutoGenerateChoudo: () => {
                                            setTimeout(() => callback({success: true, docxSent: true, url: 'https://docs.google.com/document/d/test'}), 2000);
                                        },
                                        webAppAutoGeneratePrimeTime: () => {
                                            setTimeout(() => callback({success: true, docxSent: true}), 2000);
                                        },
                                        webAppAutoGenerateFlag: () => {
                                            setTimeout(() => callback({success: true, docxSent: false}), 2000);
                                        },
                                        webAppAutoGenerateRoute847: () => {
                                            setTimeout(() => callback({success: true, docxSent: true}), 2000);
                                        },
                                        webAppAutoGenerateGodBless: () => {
                                            setTimeout(() => callback({success: true, docxSent: true}), 2000);
                                        },
                                        webAppTestAllGeneration: () => {
                                            setTimeout(() => callback([
                                                {program: 'ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª', success: true, docxSent: true},
                                                {program: 'PRIME TIME', success: true, docxSent: true},
                                                {program: 'FLAG', success: false, error: 'ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼', docxSent: false},
                                                {program: 'Route 847', success: true, docxSent: true},
                                                {program: 'God Bless Saturday', success: true, docxSent: true}
                                            ]), 3000);
                                        },
                                        webAppGetConfigInfo: () => {
                                            setTimeout(() => callback({
                                                hasSpreadsheetId: true,
                                                hasCalendarId: true,
                                                hasMusicSpreadsheetId: true,
                                                musicSheetName: 'ã‚·ãƒ¼ãƒˆ1',
                                                hasEmailAddress: true,
                                                hasDocumentTemplates: true,
                                                templateCount: 5,
                                                hasOutputFolder: true,
                                                hasPortsideCalendar: true
                                            }), 1000);
                                        },
                                        webAppGetProgramData: (programName, weekType) => {
                                            // ã‚ˆã‚Šè©³ç´°ãªãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã§å®Ÿéš›ã®æ§‹é€ ã‚’å†ç¾
                                            const demoData = {
                                                'PRIME TIME': {
                                                    'monday': {
                                                        'æ—¥ä»˜': ['2024-08-22'],
                                                        '19:41Traffic': ['äº¤é€šæƒ…å ±ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«'],
                                                        '19:43': ['19:43ã‚³ãƒ¼ãƒŠãƒ¼ãƒ‡ãƒ¼ã‚¿'],
                                                        '20:51': ['20:51ã‚³ãƒ¼ãƒŠãƒ¼ãƒ‡ãƒ¼ã‚¿'],
                                                        'å–¶æ¥­ã‚³ãƒ¼ãƒŠãƒ¼': ['å–¶æ¥­æ¡ˆä»¶ã‚µãƒ³ãƒ—ãƒ«'],
                                                        'æ¥½æ›²': ['â™ªã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ1 - æ¥½æ›²1', 'â™ªã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2 - æ¥½æ›²2'],
                                                        'ã‚²ã‚¹ãƒˆ': ['ã‚²ã‚¹ãƒˆæƒ…å ±ã‚µãƒ³ãƒ—ãƒ«'],
                                                        'æ™‚é–“æŒ‡å®šãªã—ãƒ‘ãƒ–': ['ãƒ‘ãƒ–ãƒªã‚·ãƒ†ã‚£æƒ…å ±'],
                                                        'ãƒ©ã‚¸ã‚·ãƒ§ãƒ”': ['ãƒ©ã‚¸ã‚ªã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°'],
                                                        'å…ˆè¡Œäºˆç´„ãƒ»é™å®šäºˆç´„': ['äºˆç´„æƒ…å ±ã‚µãƒ³ãƒ—ãƒ«']
                                                    },
                                                    'tuesday': {
                                                        'æ—¥ä»˜': ['2024-08-23'],
                                                        '19:41Traffic': ['ãƒ¼'],
                                                        '19:43': ['ç«æ›œæ—¥ã®ã‚³ãƒ¼ãƒŠãƒ¼'],
                                                        '20:51': ['ãƒ¼'],
                                                        'å–¶æ¥­ã‚³ãƒ¼ãƒŠãƒ¼': ['ç«æ›œå–¶æ¥­æ¡ˆä»¶'],
                                                        'æ¥½æ›²': ['â™ªç«æ›œã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ - ç«æ›œæ¥½æ›²'],
                                                        'ã‚²ã‚¹ãƒˆ': ['ãƒ¼'],
                                                        'æ™‚é–“æŒ‡å®šãªã—ãƒ‘ãƒ–': ['ãƒ¼'],
                                                        'ãƒ©ã‚¸ã‚·ãƒ§ãƒ”': ['ãƒ¼'],
                                                        'å…ˆè¡Œäºˆç´„ãƒ»é™å®šäºˆç´„': ['ãƒ¼']
                                                    }
                                                },
                                                'ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª': {
                                                    'monday': {
                                                        'æ—¥ä»˜': ['2024-08-22'],
                                                        'ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£': ['ã‚µãƒ³ãƒ—ãƒ«å¤ªéƒ'],
                                                        'ã‚²ã‚¹ãƒˆ': ['ã‚²ã‚¹ãƒˆèŠ±å­'],
                                                        'å†…å®¹': ['ç•ªçµ„å†…å®¹ã‚µãƒ³ãƒ—ãƒ«'],
                                                        'æ¥½æ›²': ['â™ªæ¥½æ›²ãƒ‡ãƒ¼ã‚¿1', 'â™ªæ¥½æ›²ãƒ‡ãƒ¼ã‚¿2'],
                                                        'æ”¾é€å¾Œ': ['æ”¾é€å¾Œæƒ…å ±']
                                                    }
                                                }
                                            };

                                            setTimeout(() => callback({
                                                success: true,
                                                programName: programName,
                                                weekType: weekType,
                                                sheetName: (weekType === 'thisWeek' ? 'ä»Šé€±' : 'ç¿Œé€±') + 'ã®ã‚·ãƒ¼ãƒˆ (25.8.18-8.24)',
                                                timestamp: new Date().toISOString(),
                                                data: demoData[programName] || {
                                                    'ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿': {
                                                        'æ³¨æ„': ['å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“'],
                                                        'åˆ©ç”¨å¯èƒ½ç•ªçµ„': Object.keys(demoData)
                                                    }
                                                }
                                            }), 2000);
                                        }
                                    };
                                }
                            };
                        }
                    }
                }
            };
        }

        // ç•ªçµ„ä¸€è¦§è¡¨ã®èª­ã¿è¾¼ã¿
        function loadProgramTable() {
            const tableDisplay = document.getElementById('table-display');
            const tableFilters = document.querySelector('.table-filters');
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            tableDisplay.innerHTML = '<div class="loading-data">ç•ªçµ„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        displayProgramTable(result.data);
                        tableFilters.style.display = 'block';
                    } else {
                        tableDisplay.innerHTML = `<div class="error-data">ã‚¨ãƒ©ãƒ¼: ${result.error}</div>`;
                    }
                })
                .withFailureHandler(function(error) {
                    tableDisplay.innerHTML = `<div class="error-data">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                })
                .webAppGetSingleProgramTable(selectedProgram);
        }

        // ç•ªçµ„åˆ¥è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«ã®èª­ã¿è¾¼ã¿ï¼ˆãƒ¡ã‚¤ãƒ³é–¢æ•°ï¼‰
        function loadSingleProgramTable() {
            loadTransposedProgramTable(); // è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç›´æ¥å‘¼ã³å‡ºã—
        }

        // è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã®ç•ªçµ„è©³ç´°è¡¨ã‚’èª­ã¿è¾¼ã¿
        function loadTransposedProgramTable() {
            const programSelect = document.getElementById('program-select-table');
            const weekSelect = document.getElementById('week-select-table');
            const selectedProgram = programSelect.value;
            const selectedWeek = weekSelect.value;
            const tableDisplay = document.getElementById('table-display');
            
            // ç•ªçµ„é¸æŠã®å³å¯†ãªæ¤œè¨¼
            if (!selectedProgram || selectedProgram.trim() === '' || selectedProgram === 'undefined') {
                tableDisplay.innerHTML = '<div class="error-data">ç•ªçµ„ã‚’é¸æŠã—ã¦ãã ã•ã„</div>';
                displayDebugLog([`[ERROR] ä¸æ­£ãªç•ªçµ„é¸æŠ: "${selectedProgram}"`]);
                return;
            }
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
            displayDebugLog([`[INFO] ç•ªçµ„é¸æŠ: "${selectedProgram}", é€±: "${selectedWeek}"`]);
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º  
            const weekLabelMap = {
                'thisWeek': 'ä»Šé€±',
                'nextWeek': 'æ¥é€±', 
                'nextWeek2': 'æ¥é€±ã®æ¬¡',
                'nextWeek3': 'æ¥é€±ã®æ¬¡ã®æ¬¡'
            };
            const weekLabel = weekLabelMap[selectedWeek] || 'ä»Šé€±';
            tableDisplay.innerHTML = `<div class="loading-data">${weekLabel}ã®è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆä¸­...</div>`;
            
            google.script.run
                .withSuccessHandler(function(result) {
                    if (result.success) {
                        displayTransposedTable(result);
                    } else {
                        tableDisplay.innerHTML = `<div class="error-data">ã‚¨ãƒ©ãƒ¼: ${result.error}</div>`;
                        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¡¨ç¤º
                        if (result.debugLogs) {
                            displayDebugLog(result.debugLogs);
                        }
                    }
                })
                .withFailureHandler(function(error) {
                    tableDisplay.innerHTML = '<div class="error-data">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + error.message + '</div>';
                    // é€šä¿¡ã‚¨ãƒ©ãƒ¼ã®å ´åˆã®ãƒ­ã‚°
                    displayDebugLog(['[ERROR] é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message, '[DEBUG] ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹: ' + (error.stack || 'ãªã—')]);
                })
                .generateTransposedProgramTable(selectedProgram, selectedWeek);
        }

        // è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡¨ç¤ºï¼ˆæ—¥ä»˜ãŒåˆ—ã€é …ç›®ãŒè¡Œï¼‰
        function displayTransposedTable(result) {
            const tableDisplay = document.getElementById('table-display');
            
            // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¡¨ç¤º
            if (result.debugLogs) {
                displayDebugLog(result.debugLogs);
            }
            
            if (!result.data || !result.data.headers || !result.data.rows) {
                tableDisplay.innerHTML = `<div class="empty-data">è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ</div>`;
                return;
            }

            const data = result.data;
            
            // ç•ªçµ„æƒ…å ±ãƒ˜ãƒƒãƒ€ãƒ¼
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="color: #2d3748; margin: 0 0 5px 0;">${data.programName}</h4>
                    <p style="color: #718096; margin: 0; font-size: 0.9rem;">é …ç›®æ•°: ${data.rows.length}é …ç›® | æœŸé–“: ${data.headers.length - 1}æ—¥é–“</p>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table transposed-table" id="transposed-detail-table" style="min-width: 800px;">
                        <thead>
                            <tr>
            `;

            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆé …ç›® + æ—¥ä»˜åˆ—ï¼‰
            data.headers.forEach((header, index) => {
                const isFirstColumn = index === 0;
                const style = isFirstColumn 
                    ? 'background: #2d3748; color: white; font-weight: bold; min-width: 150px; position: sticky; left: 0; z-index: 1;' 
                    : 'background: #4a5568; color: white; min-width: 120px; text-align: center;';
                html += `<th style="${style}">${header}</th>`;
            });

            html += `
                            </tr>
                        </thead>
                        <tbody>
            `;

            // ãƒ‡ãƒ¼ã‚¿è¡Œï¼ˆå„é …ç›®ï¼‰
            data.rows.forEach((row, rowIndex) => {
                html += '<tr>';
                
                row.forEach((cell, cellIndex) => {
                    const isFirstColumn = cellIndex === 0;
                    const isEmptyData = cell === 'ãƒ¼' || cell === '' || cell == null;
                    
                    let cellStyle = '';
                    let cellClass = '';
                    
                    if (isFirstColumn) {
                        // é …ç›®ååˆ—ï¼ˆå›ºå®šï¼‰
                        cellStyle = 'background: #f7fafc; font-weight: bold; position: sticky; left: 0; z-index: 1; border-right: 2px solid #e2e8f0;';
                        cellClass = 'item-name-cell';
                    } else {
                        // ãƒ‡ãƒ¼ã‚¿åˆ—
                        cellStyle = isEmptyData 
                            ? 'text-align: center; color: #a0aec0; font-style: italic;'
                            : 'word-wrap: break-word; font-size: 0.85rem; line-height: 1.3;';
                        cellClass = isEmptyData ? 'empty-cell' : 'data-cell';
                    }
                    
                    const maxWidth = isFirstColumn ? '150px' : '120px';
                    const displayText = isEmptyData && !isFirstColumn ? 'ãƒ¼' : cell;
                    
                    html += `<td class="${cellClass}" style="${cellStyle} max-width: ${maxWidth}; padding: 8px;">${displayText}</td>`;
                });
                
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            
            // è£œåŠ©æƒ…å ±
            html += `
                <div style="margin-top: 15px; padding: 10px; background: #e6fffa; border-left: 4px solid #38b2ac; border-radius: 4px; font-size: 0.85rem;">
                    <strong>è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º:</strong> 
                    é …ç›®ã‚’è¡Œã¨ã—ã¦ã€æ—¥ä»˜ã‚’åˆ—ã¨ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§å…¨ã¦ã®æ—¥ä»˜ãŒç¢ºèªã§ãã¾ã™ã€‚
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px; font-size: 0.8rem; color: #666;">
                    <strong>ãƒ‡ãƒãƒƒã‚°æƒ…å ±:</strong> 
                    ${data.programName} - ${data.rows.length}é …ç›® Ã— ${data.headers.length - 1}æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’è»¢ç½®è¡¨ç¤º
                </div>
            `;
            
            tableDisplay.innerHTML = html;
        }

        // é€šå¸¸ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºæ©Ÿèƒ½ï¼ˆè»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«å°‚ç”¨ã®ãŸã‚å‰Šé™¤æ¸ˆã¿ï¼‰
        // displaySingleProgramTable é–¢æ•°ã¯è»¢ç½®ãƒ†ãƒ¼ãƒ–ãƒ«å°‚ç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãŸã‚å‰Šé™¤

        // ç•ªçµ„ä¸€è¦§è¡¨ã®è¡¨ç¤º
        function displayProgramTable(programs) {
            const tableDisplay = document.getElementById('table-display');
            
            if (!programs || programs.length === 0) {
                tableDisplay.innerHTML = '<div class="empty-data">ç•ªçµ„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            let html = `
                <table class="data-table program-table" id="program-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">ç•ªçµ„å â†•</th>
                            <th onclick="sortTable(1)">ID</th>
                            <th onclick="sortTable(2)">ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•° â†•</th>
                            <th onclick="sortTable(3)">éŒ²éŸ³æ•° â†•</th>
                            <th onclick="sortTable(4)">æœ€æ–°ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ â†•</th>
                            <th onclick="sortTable(5)">ç·æ¥½æ›²æ•° â†•</th>
                            <th onclick="sortTable(6)">ç·å‘ŠçŸ¥æ•° â†•</th>
                            <th>è©³ç´°</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            programs.forEach((program, index) => {
                html += `
                    <tr>
                        <td><strong>${program.name}</strong></td>
                        <td><code>${program.id}</code></td>
                        <td>${program.episodeCount}</td>
                        <td>${program.recordingCount}</td>
                        <td>${program.latestEpisode}</td>
                        <td>${program.totalSongs}</td>
                        <td>${program.totalAnnouncements}</td>
                        <td>
                            <button class="btn btn-sm" onclick="toggleEpisodeDetails(${index})" 
                                    id="detail-btn-${index}">
                                è¡¨ç¤º
                            </button>
                        </td>
                    </tr>
                    <tr id="episode-details-${index}" style="display: none;">
                        <td colspan="8">
                            <div class="episode-details">
                                ${generateEpisodeDetailsHTML(program.episodes)}
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            tableDisplay.innerHTML = html;
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨ï¼‰
            window.currentPrograms = programs;
        }

        // ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è©³ç´°HTMLã®ç”Ÿæˆ
        function generateEpisodeDetailsHTML(episodes) {
            if (!episodes || episodes.length === 0) {
                return '<p>ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“</p>';
            }

            let html = `
                <table class="data-table episode-table">
                    <thead>
                        <tr>
                            <th>æ—¥ä»˜</th>
                            <th>æ›œæ—¥</th>
                            <th>æ¥½æ›²æ•°</th>
                            <th>å‘ŠçŸ¥æ•°</th>
                            <th>äºˆç´„æ•°</th>
                            <th>ãƒ‘ãƒ–æ æ•°</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            episodes.forEach(episode => {
                html += `
                    <tr>
                        <td>${episode.date}</td>
                        <td>${episode.weekday}</td>
                        <td>${episode.songCount}</td>
                        <td>${episode.announcementCount}</td>
                        <td>${episode.reservationCount}</td>
                        <td>${episode.publicitySlotCount}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            return html;
        }

        // ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è©³ç´°ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleEpisodeDetails(index) {
            var detailsRow = document.getElementById('episode-details-' + index);
            var button = document.getElementById('detail-btn-' + index);
            
            if (detailsRow.style.display === 'none') {
                detailsRow.style.display = '';
                button.textContent = 'éè¡¨ç¤º';
            } else {
                detailsRow.style.display = 'none';
                button.textContent = 'è¡¨ç¤º';
            }
        }

        // ç•ªçµ„è¡¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function filterProgramTable() {
            const filter = document.getElementById('program-filter').value.toLowerCase();
            const table = document.getElementById('program-table');
            const rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i += 2) { // å¥‡æ•°è¡Œã®ã¿ï¼ˆç•ªçµ„è¡Œï¼‰
                const programName = rows[i].getElementsByTagName('td')[0].textContent.toLowerCase();
                if (programName.indexOf(filter) > -1) {
                    rows[i].style.display = '';
                    if (i + 1 < rows.length) rows[i + 1].style.display = ''; // è©³ç´°è¡Œã‚‚è¡¨ç¤º
                } else {
                    rows[i].style.display = 'none';
                    if (i + 1 < rows.length) rows[i + 1].style.display = 'none'; // è©³ç´°è¡Œã‚‚éè¡¨ç¤º
                }
            }
        }

        // è¡¨ã®ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
        function sortTable(columnIndex) {
            const table = document.getElementById('program-table');
            const tbody = table.getElementsByTagName('tbody')[0];
            const rows = Array.from(tbody.getElementsByTagName('tr'));
            
            // ç•ªçµ„è¡Œã®ã¿ã‚’å–å¾—ï¼ˆå¶æ•°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
            const programRows = rows.filter((row, index) => index % 2 === 0);
            
            programRows.sort((a, b) => {
                const aValue = a.getElementsByTagName('td')[columnIndex].textContent;
                const bValue = b.getElementsByTagName('td')[columnIndex].textContent;
                
                // æ•°å€¤ã®å ´åˆã¯æ•°å€¤ã¨ã—ã¦æ¯”è¼ƒ
                if (!isNaN(aValue) && !isNaN(bValue)) {
                    return parseInt(bValue) - parseInt(aValue);
                }
                
                // æ–‡å­—åˆ—ã¨ã—ã¦æ¯”è¼ƒ
                return aValue.localeCompare(bValue);
            });

            // è¡¨ã‚’å†æ§‹ç¯‰
            tbody.innerHTML = '';
            programRows.forEach((row, index) => {
                tbody.appendChild(row);
                // å¯¾å¿œã™ã‚‹è©³ç´°è¡Œã‚‚è¿½åŠ 
                const detailsRow = rows[rows.indexOf(row) + 1];
                if (detailsRow) {
                    tbody.appendChild(detailsRow);
                }
            });
        }
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°é–¢é€£ã®æ©Ÿèƒ½
        function showDebugLog() {
            document.getElementById('debug-log-section').style.display = 'block';
            document.getElementById('debug-controls').style.display = 'none';
        }
        
        function hideDebugLog() {
            document.getElementById('debug-log-section').style.display = 'none';
            document.getElementById('debug-controls').style.display = 'block';
        }
        
        function displayDebugLog(logs) {
            var logContent = document.getElementById('debug-log-content');
            var debugControls = document.getElementById('debug-controls');
            
            if (logs && logs.length > 0) {
                // ãƒ­ã‚°ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                var formattedLogs = [];
                for (var i = 0; i < logs.length; i++) {
                    var timestamp = new Date().toLocaleTimeString();
                    formattedLogs.push('[' + timestamp + '] ' + logs[i]);
                }
                var formattedLog = formattedLogs.join('\n');
                
                logContent.textContent = formattedLog;
                debugControls.style.display = 'block';
                
                // ã‚¨ãƒ©ãƒ¼ãŒå«ã¾ã‚Œã‚‹å ´åˆã¯è‡ªå‹•çš„ã«è¡¨ç¤º
                if (logs.some(log => log.includes('[ERROR]') || log.includes('ã‚¨ãƒ©ãƒ¼'))) {
                    showDebugLog();
                }
            } else {
                logContent.textContent = 'ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“';
                debugControls.style.display = 'none';
            }
        }
        
        function clearDebugLog() {
            document.getElementById('debug-log-content').textContent = '';
            document.getElementById('debug-log-section').style.display = 'none';
            document.getElementById('debug-controls').style.display = 'none';
        }
    </script>
</body>
</html>