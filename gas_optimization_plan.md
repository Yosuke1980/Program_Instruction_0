# GASãƒ©ã‚¸ã‚ªç•ªçµ„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  åŠ¹ç‡åŒ–ç­–

## ğŸ“Š **ç¾çŠ¶åˆ†æ**

| é …ç›® | ç¾çŠ¶ | æœ€é©åŒ–å¾Œ | å‰Šæ¸›ç‡ |
|------|------|----------|--------|
| ç·é–¢æ•°æ•° | ç´„200å€‹ | ç´„50å€‹ | **75%å‰Šæ¸›** |
| é‡è¤‡æ©Ÿèƒ½ | å¤šæ•°å­˜åœ¨ | çµ±åˆå®Œäº† | **90%å‰Šæ¸›** |
| ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å·¥æ•° | é«˜ã„ | å¤§å¹…è»½æ¸› | **70%å‰Šæ¸›** |
| æ–°æ©Ÿèƒ½è¿½åŠ é›£æ˜“åº¦ | å›°é›£ | å®¹æ˜“ | **æ”¹å–„** |

---

## ğŸ¯ **åŠ¹ç‡åŒ–ã®åŸºæœ¬æ–¹é‡**

### 1. **DRYåŸå‰‡ã®å¾¹åº•**
- **é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®æ’é™¤**: åŒä¸€æ©Ÿèƒ½ã®é–¢æ•°ã‚’çµ±åˆ
- **å…±é€šå‡¦ç†ã®æŠ½è±¡åŒ–**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã«ã‚ˆã‚‹æŸ”è»Ÿæ€§å‘ä¸Š
- **è¨­å®šé§†å‹•ã®å®Ÿè£…**: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã®æ’é™¤

### 2. **é–¢æ•°ã®è²¬ä»»æ˜ç¢ºåŒ–**
- **å˜ä¸€è²¬ä»»åŸå‰‡**: 1ã¤ã®é–¢æ•°ã¯1ã¤ã®å½¹å‰²
- **éšå±¤æ§‹é€ ã®æ•´ç†**: é«˜ãƒ¬ãƒ™ãƒ«é–¢æ•°ã¨ä½ãƒ¬ãƒ™ãƒ«é–¢æ•°ã®åˆ†é›¢
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®çµ±ä¸€**: ä¸€è²«ã—ãŸå¼•æ•°ãƒ»æˆ»ã‚Šå€¤å½¢å¼

### 3. **ä¿å®ˆæ€§ã®å‘ä¸Š**
- **å‘½åè¦å‰‡ã®çµ±ä¸€**: æ©Ÿèƒ½ãŒåˆ†ã‹ã‚Šã‚„ã™ã„é–¢æ•°å
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–**: JSDocã«ã‚ˆã‚‹è©³ç´°èª¬æ˜
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼å‡¦ç†

---

## ğŸ”§ **å…·ä½“çš„ãªåŠ¹ç‡åŒ–ç­–**

## ğŸ“‹ **Phase 1: é–¢æ•°çµ±åˆï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰**

### **1.1 æŠ½å‡ºé–¢æ•°ã®çµ±åˆ**
```javascript
// ç¾åœ¨ï¼š15å€‹ã®é–¢æ•°
extractThisWeek()
extractNextWeek()
extractLastWeek()
extractWeekByNumber()
extractLatestWeek()
extractOldestWeek()
extractRelativeWeek()
extractSpecificWeekByProgram()
// ... ä»–7å€‹

// â†“ çµ±åˆå¾Œï¼š1å€‹ã®é–¢æ•°
function extractWeekData(options = {}) {
  const {
    weekOffset = 0,        // -1(å…ˆé€±), 0(ä»Šé€±), 1(æ¥é€±)
    outputFormat = 'program', // 'week', 'program'
    actions = [],          // ['email', 'document', 'spreadsheet']
    programFilter = null,  // ç‰¹å®šç•ªçµ„ã®ã¿æŠ½å‡º
    sheetName = null      // ç›´æ¥ã‚·ãƒ¼ãƒˆåæŒ‡å®š
  } = options;
  
  // çµ±åˆå‡¦ç†
}
```

### **1.2 æ¥½æ›²ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ã®çµ±åˆ**
```javascript
// ç¾åœ¨ï¼š5å€‹ã®é–¢æ•°
formatMusicList()
formatMusicListSimple()
formatMusicListBullet()
formatMusicListTable()
formatMusicListOneLine()

// â†“ çµ±åˆå¾Œï¼š1å€‹ã®é–¢æ•°
function formatMusicList(musicItems, format = 'default', options = {}) {
  const formats = {
    'default': (items) => items.map((item, i) => `${i + 1}. ${item}`),
    'simple': (items) => items.map(item => item),
    'bullet': (items) => items.map(item => `â€¢ ${item}`),
    'table': (items) => generateTable(items),
    'oneline': (items) => items.join('\n')
  };
  
  return formats[format] ? formats[format](musicItems) : formats['default'](musicItems);
}
```

### **1.3 è‡ªå‹•ç”Ÿæˆé–¢æ•°ã®çµ±åˆ**
```javascript
// ç¾åœ¨ï¼š5å€‹ã®é–¢æ•°
autoGenerateChoudoDocument()
autoGeneratePrimeTimeDocument()
autoGenerateFlagDocument()
autoGenerateRoute847Document()
autoGenerateGodBlessDocument()

// â†“ çµ±åˆå¾Œï¼š1å€‹ã®é–¢æ•°
function autoGenerateDocument(programName, options = {}) {
  const {
    weekOffset = 1,        // ç¿Œé€±ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    outputFormat = 'docx', // 'docx', 'pdf', 'google'
    sendEmail = true,
    createSpreadsheet = false
  } = options;
  
  const programConfigs = {
    'ã¡ã‚‡ã†ã©ã„ã„ãƒ©ã‚¸ã‚ª': { defaultWeekOffset: 1, schedule: 'weekly' },
    'PRIME TIME': { defaultWeekOffset: 1, schedule: 'weekly' },
    'FLAG': { defaultWeekOffset: 0, schedule: '4weeks' },
    'Route 847': { defaultWeekOffset: 0, schedule: 'single' },
    'God Bless Saturday': { defaultWeekOffset: 0, schedule: 'single' }
  };
  
  // çµ±åˆå‡¦ç†
}
```

---

## ğŸ“± **Phase 2: WebAppé–¢æ•°ã®æ•´ç†ï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰**

### **2.1 WebAppãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°ã®çµ±åˆ**
```javascript
// ç¾åœ¨ï¼š40å€‹ä»¥ä¸Šã®webAppé–¢æ•°
webAppAutoGenerateChoudo()
webAppAutoGeneratePrimeTime()
webAppAutoGenerateFlag()
webAppTestAllGeneration()
webAppGetExecutionStatus()
// ... ä»–35å€‹

// â†“ çµ±åˆå¾Œï¼š5å€‹ã®é–¢æ•°
function webAppExecute(action, params = {}) {
  const actions = {
    'generate': (params) => autoGenerateDocument(params.program, params.options),
    'extract': (params) => extractWeekData(params.options),
    'test': (params) => runSystemTest(params.testType),
    'update': (params) => updateData(params.dataType),
    'debug': (params) => debugSystem(params.target)
  };
  
  try {
    return {
      success: true,
      data: actions[action] ? actions[action](params) : null,
      timestamp: new Date().toISOString()
    };
  } catch (error) {
    return {
      success: false,
      error: error.toString(),
      timestamp: new Date().toISOString()
    };
  }
}

function webAppGetStatus() { /* ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³å–å¾— */ }
function webAppGetConfig() { /* è¨­å®šæƒ…å ±å–å¾— */ }
function webAppUpdateConfig(config) { /* è¨­å®šæ›´æ–° */ }
function webAppLog(action, data) { /* ãƒ­ã‚°è¨˜éŒ² */ }
```

---

## ğŸ§ª **Phase 3: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°é–¢æ•°ã®æ•´ç†ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰**

### **3.1 ãƒ†ã‚¹ãƒˆé–¢æ•°ã®çµ±åˆ**
```javascript
// ç¾åœ¨ï¼š30å€‹ã®ãƒ†ã‚¹ãƒˆé–¢æ•°
testAllAutoGeneration()
testMusicDataUpdate()
testAdvanceBooking()
testPortsideInformation()
// ... ä»–26å€‹

// â†“ çµ±åˆå¾Œï¼š3å€‹ã®é–¢æ•°
function runSystemTest(testType = 'all', options = {}) {
  const tests = {
    'all': () => runAllTests(),
    'extraction': () => testDataExtraction(),
    'generation': () => testDocumentGeneration(),
    'music': () => testMusicData(),
    'calendar': () => testCalendarIntegration(),
    'advance': () => testAdvanceBooking(),
    'performance': () => testPerformance()
  };
  
  return tests[testType] ? tests[testType]() : tests['all']();
}

function debugSystem(target, options = {}) {
  const debuggers = {
    'advance': () => debugAdvanceBooking(options),
    'music': () => debugMusicData(options),
    'calendar': () => debugCalendarData(options),
    'extraction': () => debugDataExtraction(options)
  };
  
  return debuggers[target] ? debuggers[target]() : null;
}

function validateConfiguration() {
  // è¨­å®šã®å¦¥å½“æ€§æ¤œè¨¼
}
```

---

## ğŸ—‚ï¸ **Phase 4: ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®æœ€é©åŒ–ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰**

### **4.1 è¨­å®šç®¡ç†ã®æ”¹å–„**
```javascript
// è¨­å®šã®å‹å®‰å…¨æ€§ã¨æ‹¡å¼µæ€§å‘ä¸Š
class ConfigManager {
  constructor() {
    this.config = this.loadConfig();
    this.validate();
  }
  
  loadConfig() {
    try {
      return CONFIG;
    } catch (error) {
      throw new Error('è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  }
  
  validate() {
    const required = [
      'SPREADSHEET_ID',
      'CALENDAR_ID',
      'EMAIL_ADDRESS',
      'DOCUMENT_TEMPLATES'
    ];
    
    required.forEach(key => {
      if (!this.config[key]) {
        throw new Error(`å¿…é ˆè¨­å®šé …ç›®ãŒä¸è¶³: ${key}`);
      }
    });
  }
  
  get(key, defaultValue = null) {
    return this.config[key] || defaultValue;
  }
  
  getDocumentTemplate(programName) {
    return this.config.DOCUMENT_TEMPLATES[programName];
  }
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
const configManager = new ConfigManager();
```

### **4.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€**
```javascript
class SystemError extends Error {
  constructor(message, code, context = {}) {
    super(message);
    this.code = code;
    this.context = context;
    this.timestamp = new Date().toISOString();
  }
}

function handleError(error, context = {}) {
  const errorLog = {
    message: error.message,
    code: error.code || 'UNKNOWN',
    context: { ...context, ...error.context },
    timestamp: error.timestamp || new Date().toISOString(),
    stack: error.stack
  };
  
  console.error('System Error:', errorLog);
  
  // é‡è¦ãªã‚¨ãƒ©ãƒ¼ã¯ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
  if (error.code && ['CONFIG_ERROR', 'DATA_CORRUPTION'].includes(error.code)) {
    sendErrorNotification(errorLog);
  }
  
  return {
    success: false,
    error: error.message,
    code: error.code,
    timestamp: errorLog.timestamp
  };
}
```

---

## ğŸ“ˆ **Phase 5: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆå„ªå…ˆåº¦ï¼šä½ï¼‰**

### **5.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…**
```javascript
class CacheManager {
  constructor() {
    this.cache = new Map();
    this.ttl = 30 * 60 * 1000; // 30åˆ†
  }
  
  get(key) {
    const item = this.cache.get(key);
    if (!item) return null;
    
    if (Date.now() > item.expires) {
      this.cache.delete(key);
      return null;
    }
    
    return item.data;
  }
  
  set(key, data) {
    this.cache.set(key, {
      data: data,
      expires: Date.now() + this.ttl
    });
  }
  
  clear() {
    this.cache.clear();
  }
}

// æ¥½æ›²ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¾‹
function getMusicDataCached() {
  const cacheKey = 'musicData';
  let musicData = cacheManager.get(cacheKey);
  
  if (!musicData) {
    musicData = getMusicData();
    cacheManager.set(cacheKey, musicData);
  }
  
  return musicData;
}
```

### **5.2 ãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ–**
```javascript
function batchProcessPrograms(programs, operation, batchSize = 3) {
  const results = [];
  
  for (let i = 0; i < programs.length; i += batchSize) {
    const batch = programs.slice(i, i + batchSize);
    
    const batchResults = batch.map(program => {
      try {
        return operation(program);
      } catch (error) {
        return handleError(error, { program });
      }
    });
    
    results.push(...batchResults);
    
    // ãƒãƒƒãƒé–“ã®å¾…æ©Ÿï¼ˆAPIåˆ¶é™å¯¾ç­–ï¼‰
    if (i + batchSize < programs.length) {
      Utilities.sleep(1000);
    }
  }
  
  return results;
}
```

---

## ğŸ“‹ **å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**

| Phase | æœŸé–“ | å·¥æ•° | å„ªå…ˆåº¦ | å‰Šæ¸›åŠ¹æœ |
|-------|------|------|--------|----------|
| **Phase 1** | 2é€±é–“ | 40æ™‚é–“ | é«˜ | é–¢æ•°æ•°50%å‰Šæ¸› |
| **Phase 2** | 1é€±é–“ | 20æ™‚é–“ | é«˜ | WebAppé–¢æ•°90%å‰Šæ¸› |
| **Phase 3** | 1é€±é–“ | 15æ™‚é–“ | ä¸­ | ãƒ†ã‚¹ãƒˆé–¢æ•°80%å‰Šæ¸› |
| **Phase 4** | 1é€±é–“ | 25æ™‚é–“ | ä¸­ | ä¿å®ˆæ€§å‘ä¸Š |
| **Phase 5** | 1é€±é–“ | 15æ™‚é–“ | ä½ | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š |
| **åˆè¨ˆ** | **6é€±é–“** | **115æ™‚é–“** | - | **å…¨ä½“75%åŠ¹ç‡åŒ–** |

---

## ğŸ“Š **åŠ¹æœæ¸¬å®šæŒ‡æ¨™**

### **é‡çš„æŒ‡æ¨™**
- **é–¢æ•°æ•°**: 200å€‹ â†’ 50å€‹ï¼ˆ75%å‰Šæ¸›ï¼‰
- **ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„8,000è¡Œ â†’ ç´„3,000è¡Œï¼ˆ62%å‰Šæ¸›ï¼‰
- **é‡è¤‡ã‚³ãƒ¼ãƒ‰**: å¤šæ•° â†’ ã‚¼ãƒ­ï¼ˆ100%å‰Šæ¸›ï¼‰

### **è³ªçš„æŒ‡æ¨™**
- **å¯èª­æ€§**: å¤§å¹…å‘ä¸Š
- **ä¿å®ˆæ€§**: å¤§å¹…å‘ä¸Š
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: å¤§å¹…å‘ä¸Š
- **æ–°æ©Ÿèƒ½è¿½åŠ **: 3å€é«˜é€ŸåŒ–

### **é‹ç”¨æŒ‡æ¨™**
- **ãƒã‚°ç™ºç”Ÿç‡**: 50%å‰Šæ¸›äºˆæƒ³
- **æ©Ÿèƒ½è¿½åŠ å·¥æ•°**: 70%å‰Šæ¸›äºˆæƒ³
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å·¥æ•°**: 80%å‰Šæ¸›äºˆæƒ³

---

## âš ï¸ **ãƒªã‚¹ã‚¯ç®¡ç†**

### **æŠ€è¡“çš„ãƒªã‚¹ã‚¯**
- **æ—¢å­˜æ©Ÿèƒ½ã®å‹•ä½œä¸è‰¯**: æ®µéšçš„ç§»è¡Œã§ãƒªã‚¹ã‚¯è»½æ¸›
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹**: äº‹å‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿæ–½
- **è¨­å®šã®äº’æ›æ€§**: æ—§è¨­å®šã¨ã®äº’æ›æ€§ç¶­æŒ

### **é‹ç”¨ãƒªã‚¹ã‚¯**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ··ä¹±**: äº‹å‰ã®èª¬æ˜ã¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ•´å‚™
- **ç§»è¡ŒæœŸé–“ã®å·¥æ•°å¢—**: ä¸¦è¡Œé‹ç”¨æœŸé–“ã®è¨­å®š
- **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ**: æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒ

---

## ğŸ¯ **æˆåŠŸåŸºæº–**

### **çŸ­æœŸç›®æ¨™ï¼ˆ1ãƒ¶æœˆï¼‰**
- [ ] Phase 1-2 å®Œäº†ï¼ˆé–¢æ•°æ•°60%å‰Šæ¸›ï¼‰
- [ ] æ—¢å­˜æ©Ÿèƒ½ã®100%å‹•ä½œç¢ºèª
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ›´æ–°

### **ä¸­æœŸç›®æ¨™ï¼ˆ3ãƒ¶æœˆï¼‰**
- [ ] å…¨Phaseå®Œäº†ï¼ˆé–¢æ•°æ•°75%å‰Šæ¸›ï¼‰
- [ ] æ–°æ©Ÿèƒ½è¿½åŠ é€Ÿåº¦3å€å‘ä¸Š
- [ ] ãƒã‚°ç™ºç”Ÿç‡50%å‰Šæ¸›

### **é•·æœŸç›®æ¨™ï¼ˆ6ãƒ¶æœˆï¼‰**
- [ ] ã‚·ã‚¹ãƒ†ãƒ å®‰å®šç¨¼åƒ
- [ ] è¿½åŠ æ©Ÿèƒ½é–‹ç™ºã®é«˜é€ŸåŒ–
- [ ] ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å·¥æ•°80%å‰Šæ¸›